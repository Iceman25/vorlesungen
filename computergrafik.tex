\chapter{Computergrafik}

Zusammenfassung der Vorlesung "`Computergrafik"' aus dem Wintersemester 2014.\footnote{\url{http://cg.ivd.kit.edu/lehre/ws2014/cg/index.php}}

\section{Farben, Bilder und Perzeption}

\subsection{Bilder, Darstellung und Framebuffer}

\subsubsection{Gammakorrektur}
\begin{itemize}
	\item Bilder sind oft zu hell oder zu dunkel
	\item Korrekturfunktion für das menschlichem Empfinden vpn physikalischen Helligkeitsunterschieden
	\item Ein idealer Monitor bildet einen Pixel-Wert \(n\) auf die Intensität \(I(n)\) ab
	\item Vergleichsweise wenige Stufen sind ausreichend
\end{itemize}


\subsection{Licht, Sehen und Wahrnehmung}

\subsubsection{Perzeption vs. Messung}
\begin{itemize}
	\item Das menschliche Auge kann die spektrale Zusammensetzung von Licht nicht erfassen
	\item Das Auge (und das Gehirn) macht eingeschränkte Messungen und passt sich den äußeren Umständen an
\end{itemize}

\subsubsection{Das Auge}
\begin{itemize}
	\item Zapfen: Für photopisches Sehen (Tagsehen) und trichromatisches Farbsehen. Blau (7\%), Grün (37\%), Rot (56\%)
	\item Stäbchen: Für skotopisches, monochromatisches Sehen (Nachtsehen); lichtempfindlicher, überall auf der Retina
\end{itemize}

\subsubsection{Farbmischungen}
\begin{itemize}
	\item \textbf{Additiv}
	\begin{itemize}
		\item RGB: \(C=rR+gG+bB\)
		\item Farbkombination durch Addition der Spektren
		\item Biologisch und technisch motiviert
		\item Anwendung: Monitore, Beamer
	\end{itemize}
	\item \textbf{Subtraktiv}
	\begin{itemize}
		\item CMY(K): Jede Primärfarbe absorbiert einen Teil des Spektrums; Key ist beim Druck meist Schwarz
		\item Dualer Farbraum zu RGB
		\item Farbkombination durch Multiplikation der Spektren
		\item Anwendung: Film, Farbstifte, Farbdrucker
	\end{itemize}
	\item \textbf{HSV}
	\begin{itemize}
		\item Farbton (Hue), Sättigung (Saturation) und Helligkeit (Value)
		\item Darstellung als Zylinder oder hexagonaler Kegel
		\item Anwendung: Benutzerschnittstellen, da intuitiv
	\end{itemize}
	\item \textbf{XYZ}
	\begin{itemize}
		\item Beschreibung aller wahrnehmbaren Farben
		\item Farbraum mit rein positiven Color Matching Funktionen
		\item Lineare Abbildung \[XYZ \Leftrightarrow RGB\]
	\end{itemize}
\end{itemize}

\subsubsection{Farbraum}
Die Menge der Farben, die mit einem bestimmten Modell beschrieben werden können.

\subsubsection{Graßmannsche Gesetze}
Jeder Farbeindruc kann mit drei Grundgrößen beschrieben werden.


\subsection{CIE Color Matching Functions}
\begin{itemize}
	\item Wahrnehmungsexperimente: Referenzfarbe vorgegeben, soll durch drei Grundfarben reproduziert werden
	\item Problem: Nicht alle Farben konnte reproduziert werden
	\item Lösung: Primärfarben als negativer Vergleichwert
\end{itemize}


\subsection{Weber-Fechner-Gesetz}
Die subjektiv empfundene Stärke von Sinneseindrücken ist proportional zum Logorithmus der Intensität des physikalisch Reizes (1:2 wird empfunden wie 100:200).


\subsection{Ray Tracing}
\begin{itemize}
	\item Idee: Geometrische Überlegungen über Lichtstrahlen
	\item Verfolge die Lichtstrahlen, die die Öffnung der Lochkamera passieren, finde Pixel, die das Objekt beeinflussen und bestimme Pixelfarbe
\end{itemize}


\subsection{Nyquist-Shannon-Abtasttheorem}
Ein kontinuierliches, bandbegrenztes Signal mit einer maximalen Frequenz \(f_{max}\) muss mit einer Frequenz größer \(2f_{max}\) abgetastet werden, damit aus dem diskreten Signal das Ursprungssignal exakt rekonstruiert werden kann.



\section{Ray Tracing}

\subsection{Grundbegriffe}

\subsubsection{Virtuelle Kamera}
Definiert durch:
\begin{itemize}
	\item Position und Blickrichtung
	\item Orientierung der vertikalen Achse
	\item Bildebene vor der Kamera
\end{itemize}

\subsubsection{Rasterisierung}
\begin{itemize}
	\item Idee: Transformation von Geometrie (3D auf 2D-Bildebene)
	\item Für alle Objekte: Finde Pixel, die das Objekt bedeckt und bestimme Pixelfarbe
\end{itemize}

\subsubsection{Bildsynthese}
\begin{itemize}
	\item Erzeuge ein Rasterbild aus einer Szenenbeschreibung (Objekte), also bestimme, welche Objekte die Farbe jedes Pixels beeinflussen
	\item \textbf{Objektbasiert (Object-Order Rendering)}
	\begin{enumerate}
		\item Betrachte ein Objekt/Fläche nach der anderen
		\item Finde heraus, welche Pixel das Objekt bedecken
		\item Bestimme die Pixelfarbe
	\end{enumerate}
	\item \textbf{Bildbasiert (Image-Order Rendering)}
	\begin{enumerate}
		\item Betrachte einen Pixel nach dem anderen
		\item Finde heraus, welches Objekt an dieser Stelle sichtbar ist
		\item Bestimme die Pixelfarbe
	\end{enumerate}
\end{itemize}

\subsubsection{Strahlentypen}
\begin{itemize}
	\item Sichtstrahl: Halbgerade von der Kamera durch den Pixel
\end{itemize}


\subsection{Prinzip}
\begin{itemize}
	\item Betrachte einen Pixel nach dem anderen (ray generation)
	\item Finde das Objekt, das die Kamera durch diesen Pixel sieht (ray intersection)
	\item Berechne Farbe und Schattierung (shading)
	\item Rekursive Fortsetzung der Strahlenverfolgung
\end{itemize}

\subsubsection{Prinzipielles Vorgehen im Detail}
\begin{enumerate}
	\item \textbf{ray generation}
	\begin{itemize}
		\item Erzeugung von Sichtstrahlen (vom Betrachter zur Bildebene) durch jeden Pixel der Bildebene
		\item Die Bildebene ist festgelegt durch den Abstand zur Kamera und die Größe der Ebene
		\item Typischerweise ist das Sichtfeld orthogonal mittleren Sichtstrahl und symmetrisch 
	\end{itemize}
	\item \textbf{ray intersection}
	\begin{itemize}
		\item Finde Objekt, das den Sichtstrahl schneidet und dessen Schnittpunkt der Kamera am nächsten ist
		\item Schnittpunktberechnung beispielsweise über Baryzentrische Koordinaten
	\end{itemize}
	\item \textbf{shading}
\end{enumerate}


\subsection{Materialeigenschaften}

\subsubsection{Schattierung/Beleuchtungsberechnung}
\begin{itemize}
	\item Essentiell für dreidimensionalen Eindruck
	\item Interaktion von Lichtquellen und Oberflächen
	\item \textbf{Extrema}
	\begin{itemize}
		\item Spekulare Reflexion: Einfallswinkel gleich Ausfallswinkel
		\item Diffuse (lambertsche) Reflexion: Gleiche Reflexion in alle Richtungen
	\end{itemize}
\end{itemize}

\subsubsection{Licht-Material-Interaktion}
Was passiert, wenn Licht auf eine Oberfläche trifft?
\begin{itemize}
	\item Ein Teil wird reflektiert
	\item Ein Teil dringt ins Material ein
	\item Das Verhältnis ist abhängig vom Einfallswinkel (\textit{Fresnel-Effekt}) und den Brechungsindizes beider Materialien
\end{itemize}

\subsubsection{Reflexion}
\begin{itemize}
	\item Diffus: Licht erhellt das Objekt gleichmäßig
	\item Glänzend (imperfekt spiegelnd): Licht wirft einen Kegel in Richtung Ausfallswinkel
	\item Spekular: Perfekte Spiegelung (Einfallswinkel = Ausfallswinkel)
\end{itemize}

\subsubsection{BRDFs}
Bidirektionale Reflektanz-Verteilungsfunktion (Bidirectional Reflectance Distribution Function)
\begin{itemize}
	\item Radiometrisches Konzept, um die Reflexion an einem Oberflächenpunkt zu beschreiben
	\item \textbf{Entwicklung von BRDFs}
	\begin{itemize}
		\item Messung von realen Materialproben mit einem Goniorereflektometer
		\item Phänomenologisch-motivierte Modelle: Wenige, intuitiv verständliche Parameter; nur in beschränktem Maße realistisch
		\item Physikalisch-motivierte Modelle: Exakte Resultate; Einstellung der Parameter allerdings schwierig
	\end{itemize}
\end{itemize}


\subsubsection{Phong-Bleuchtungsmodell}
Phänomologisches Modell, das die Reflexion mit drei Komponenten modelliert:
\begin{itemize}
	\item Ambient: Indirekte Beleuchtung, Licht von anderen Oberflächen
	\item Diffus: Nach dem Lambertschen Gesetz
	\item Spekular: Imperfekte Spiegelung
	\begin{itemize}
		\item Durch gerichtete Reflexion entstehen Glanzlichter
		\item Findet nur in Richtung des Ausfallswinkels statt (Geometrisch: Spiegelung des Lichtvektors an der Normalen)
		\item Größe des Fokus abhängig vom Phong-Exponenten (großer Exponent \(\rightarrow\) kleiner Kegel)
	\end{itemize}
\end{itemize}

\subsubsection{Formel zur Berechnung}
\[I = k_a\cdot I_L + k_d\cdot I_L \cdot (n\cdot L) + k_s\cdot I_L \cdot (R_L \cdot V)^n\]

\subsubsection{Stereo-Rendering}
\textbf{Idee:} Für jedes Auge ein anderes Bild durch die Einführung einer zweiten Kamera.

\subsubsection{Schattierung von Dreiecksnetzen}
\begin{itemize}
	\item Stückweise lineare Approximation einer (gekrümmten) Oberfläche durch Dreiecke
	\item Flat Shading: Verwendung der Dreiecksnormalen zur Beleuchtungsberechnung (Interpolation der Normalen der Eckpunkte)
	\item Scharfe Kanten brauchen mehrere Normalen
	\item Typischerweise werden drei Eckpunkte, drei Normalen sowie zusätzliche Attribute (beispielsweise Farben) gespeichert
	\item Phong Shading: Beleuchtungsberechnung mit interpolierten Normalen
\end{itemize}

\subsubsection{Licht und Schatten}
\begin{itemize}
	\item Objekte können Schatten werfen
	\item Schattenstrahl: Senden eines Strahls von der Oberfläche zur Lichtquelle hin, um zu gucken, ob ein anderes Objekt geschnitten wird
	\item Problem: Endliche Genauigkeit der Gleitkommadarstellung, dadurch treten Artefakte auf und die Strahl schneidet eventuell die Oberfläche von der er startet nochmal
	\item \textbf{Lösungen}
	\begin{itemize}
		\item Teste explizit, ob das geschnittene Objekt bereits geschnitten wurde
		\item Starte etwas weiter weg von der Oberfläche
	\end{itemize}
\end{itemize}

\subsubsection{Arten von Lichtquellen}
\begin{itemize}
	\item Punktlichtquellen: Definiert durch Position und Intensität. Bei realen Lichtquellen: Abfall der Intensität mit dem Abstandsquadrat
	\item Paralleles Licht: Definiert durch Richtung und Flussdichte, z.B. Sonnenlicht
	\item \textbf{Andere Lichtquellentypen}
	\begin{itemize}
		\item Strahler (Spot-Lights): Lichtkegel mit Abstrahlcharakteristik \(cos^n \Theta\)
		\item Flächenlichtquellen
		\item Punktlichtquellen mit Richtungscharakteristik
	\end{itemize}
\end{itemize}

\subsubsection{Primär- und Sekundärstrahlen}
\begin{itemize}
	\item Ray Tracing basiert auf den Gesetzen der geometrischen Optik
	\item Grundidee: Strahlenverfolgung vom Auge aus
	\item Rekursion um Spiegelung und Lichtbrechung darzustellen \(\rightarrow\) Sekundärstrahlen: Reflexionsstrahlen und Transmissionsstrahlen
	\item Steigende Genauigkeit mit steigender Rekursionstiefe
\end{itemize}

\subsubsection{Snellsches Brechungsgesetz}
\begin{itemize}
	\item Beschreiben der Richtungsänderung einer Welle (Licht) beim Übergang von einem Medium in ein anderes mit unterschiedlicher Brechungszahl
	\item Licht bewegt sich in unterschiedlichen Medien unterschiedlich schnell: \(\eta = \frac{c_{Vakuum}}{c_{Medium}}\)
	\item Die Brechzahl \(\eta\) ist wellenlängenabhängig \(\rightarrow\) Aufspaltung in unterschiedliche Wellenlängen (Dispersion)
	\item \textbf{Brechungsgesetz}
	\begin{itemize}
		\item \(\eta_i sin(\Theta_i) = \eta_t sin(\Theta_t)\)
		\item Übergang ins optisch dichtere Medium (\(\eta_t > \eta_i\)): Brechung zum Lot hin
		\item Übergang ins optisch dünnere Medium (\(\eta_t < \eta_i\)): Brechung vom Lot weg
	\end{itemize}
	\item Fresnel-Effekt: Verteilung der Strahlendichte
	\item Totalreflexion: Wird beim Übergang ein bestimmter Grenzwinkel überschritten wird der Strahl komplett reflektiert
\end{itemize}



\section{Appendix A: Baryzentrische Koordinaten}
Baryzentrische Koordinaten dienen in der linearen Algebra und in der Geometrie dazu, die Lage von Punkten in Bezug auf eine gegebene Strecke, ein gegebenes Dreieck, ein gegebenes Tetraeder oder allgemeiner ein gegebenes Simplex zu beschreiben. Der Punkt wird dargestellt durch die Koeffizienten einer Affinkombination (also einer Linearkombination von Punkten, bei der die Summe der Koeffizienten 1 ist).\footnote{\url{http://de.wikipedia.org/wiki/Baryzentrische_Koordinaten}}

\subsection{Anwendungen}

\subsubsection{Liegt ein Punkt innerhalb eines Dreiecks?}
Der Punkt \(Q = \lambda_1 P_1 + \lambda_2 P_2 + \lambda_3 P_3\) liegt innerhalb des Dreiecks \(\triangle(P_1,P_2,P_3)\), wenn \(\lambda_1,\lambda_2,\lambda_3\) positiv sind.

\subsubsection{Lineare Interpolation von Farbwerten}
\begin{itemize}
	\item \textbf{Gegeben:} Eine Farbe \(c_1,c_2,c_3\) als RGB-Triple zu jedem Eckpunkt.
	\item \textbf{Gesucht:} Die interpolierte Farbe \(c_Q\) an einem Punkt \(Q\) auf dem Dreieck
	\item \textbf{Lösung:} Berechne \(\lambda_1,\lambda_2,\lambda_3\), dann ist \(c_Q=\lambda_1 c_1+\lambda_2 c_2 + \lambda_3 C_3\)
\end{itemize}

\subsubsection{Berechnung des Schnittpunkts eines Dreiecks und einer Geraden}
\begin{enumerate}
	\item \(r(t) = e+t\cdot d\), \(|d|=1\)
	\item Gleichsetzen
	\begin{itemize}
		\item \(r(t) = Q(\lambda_2,\lambda_3)\)
		\item \(e+t\cdot d = P_1+\lambda_2(P_2-P_1)+\lambda_3(P_3-P_1)\)
		\item Schnittpunkt, wenn \(\lambda_2+\lambda_3<1 \wedge \lambda_2 > 0 \wedge \lambda_3 >0\)
	\end{itemize}
	\item 3 Gleichungen mit 3 Unbekannten: \(e_x+t\cdot d_x=P_{1,x}+\lambda_2(P_{2,x}-P_{1,x})+\lambda_3(P_{3,x}-P_{1,x},...\)
	\item Lösung mittels Cramerscher Regel
	\begin{itemize}
		\item Baryzentrische Koordinaten müssen noch auf Positivität getestet werden
		\item Direkte Umsetzung im Programmcode
		\item Effizient, ohne Umweg über Ebenengleichung
	\end{itemize}
\end{enumerate}
